{% extends "base.html" %}

{% block content %}
<div class="page-header mb-4">
  <div class="d-flex justify-content-between align-items-center">
    <div>
      <h1 class="h2"><i class="bi bi-truck"></i> Supplier Directory</h1>
      <p class="text-muted">Browse and search supplier information</p>
    </div>
    {% if current_user.role in ['staff', 'admin'] %}
    <a href="{{ url_for('kb_suppliers.new_supplier') }}" class="btn btn-primary">
      <i class="bi bi-plus-circle"></i> Add Supplier
    </a>
    {% endif %}
  </div>

  <!-- Search Bar -->
  <div class="card">
    <div class="card-body">
      <form method="GET" action="{{ url_for('kb_suppliers.list_suppliers') }}">
        <div class="input-group">
          <span class="input-group-text"><i class="bi bi-search"></i></span>
          <input type="text" class="form-control" name="search"
                 placeholder="Search suppliers by name..."
                 value="{{ search_query }}">
          <button type="submit" class="btn btn-primary">Search</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Suppliers List -->
<div class="row">
  {% if suppliers %}
    {% for supplier in suppliers %}
    <div class="col-md-6 col-lg-4 mb-4">
      <div class="card h-100">
        <div class="card-body">
          <h5 class="card-title">
            <a href="{{ url_for('kb_suppliers.view_supplier', supplier_id=supplier.id) }}"
               class="text-decoration-none">
              {{ supplier.name }}
            </a>
          </h5>

          {% if supplier.category %}
          <p class="text-muted small mb-2">
            <i class="bi bi-tag"></i> {{ supplier.category }}
          </p>
          {% endif %}

          {% if supplier.description %}
          <p class="card-text text-muted small">
            {{ supplier.description[:120] }}{% if supplier.description|length > 120 %}...{% endif %}
          </p>
          {% endif %}

          <div class="mt-3">
            {% if supplier.phone %}
            <p class="mb-1 small">
              <i class="bi bi-telephone"></i> {{ supplier.phone }}
            </p>
            {% endif %}

            {% if supplier.email %}
            <p class="mb-1 small">
              <i class="bi bi-envelope"></i> {{ supplier.email }}
            </p>
            {% endif %}

            {% if supplier.website %}
            <p class="mb-1 small">
              <i class="bi bi-globe"></i>
              <a href="{{ supplier.website }}" target="_blank" class="text-decoration-none">
                Website
              </a>
            </p>
            {% endif %}
          </div>
        </div>
        <div class="card-footer bg-transparent">
          <a href="{{ url_for('kb_suppliers.view_supplier', supplier_id=supplier.id) }}"
             class="btn btn-sm btn-outline-primary">
            <i class="bi bi-eye"></i> View Details
          </a>
          {% if current_user.role in ['staff', 'admin'] %}
          <a href="{{ url_for('kb_suppliers.edit_supplier', supplier_id=supplier.id) }}"
             class="btn btn-sm btn-outline-secondary">
            <i class="bi bi-pencil"></i> Edit
          </a>
          {% endif %}
        </div>
      </div>
    </div>
    {% endfor %}
  {% else %}
    <div class="col-12">
      <div class="alert alert-info">
        <i class="bi bi-info-circle"></i> No suppliers found.
        {% if current_user.role in ['staff', 'admin'] %}
        <a href="{{ url_for('kb_suppliers.new_supplier') }}">Add the first supplier</a>.
        {% endif %}
      </div>
    </div>
  {% endif %}
</div>

<!-- Quick Link back to Articles -->
<div class="mt-4">
  <a href="{{ url_for('kb_articles.list_articles') }}" class="btn btn-outline-secondary">
    <i class="bi bi-arrow-left"></i> Back to Articles
  </a>
</div>

{% endblock %}
